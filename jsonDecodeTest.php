<?php
/**
 * Created by PhpStorm.
 * User: ben
 * Date: 3/18/14
 * Time: 4:40 PM
 */

$string = '{"timestamp":1395158965,"version":"1.0","payload":[{"LONGTERM":{"Processes.whiptail.root.ioreadkbytes":1196032,"Processes.thd.nobody.mem":636,"Processes.getty.root.cpu":6,"Processes.udevd.root.cpu":55,"Disk./dev/mmcblk0p1.fs.free":39141376,"Processes.getty.root.ioreadkbytes":167936,"Processes.dhclient.root.count":1,"Processes.mopidy.mopidy.cpu":77522,"Processes.login.root.iowritekbytes":4096,"Processes.rsyslogd.root.iowritekbytes":184320,"Processes.ntpd.ntp.iowritekbytes":4096,"Processes.bash.pi.cpu":217,"Processes.login.root.mem":1328,"Disk./dev/mmcblk0p2.fs.ifree":406875,"Processes.linode-longview.root.count":1,"Processes.ifplugd.root.cpu":575,"Processes.sshd.root.mem":3964,"Processes.rsyslogd.root.count":1,"Processes.bash.root.mem":2472,"Processes.dhclient.root.cpu":0,"Processes.init.root.iowritekbytes":491520,"Processes.dbus-daemon.messagebus.iowritekbytes":0,"Processes.bash.root.count":1,"Disk./dev/mmcblk0p1.reads":53,"Processes.wpa_supplicant.root.count":1,"Disk./dev/mmcblk0p2.fs.total":7814586368,"Processes.sshd.pi.count":1,"Processes.raspi-config.root.iowritekbytes":0,"Processes.whiptail.root.iowritekbytes":0,"Processes.raspi-config.root.count":1,"Disk./dev/mmcblk0p2.reads":6289,"Processes.dbus-daemon.messagebus.mem":996,"Processes.init.root.count":1,"Disk./dev/mmcblk0p1.writes":0,"Processes.sshd.root.ioreadkbytes":5079040,"Processes.mopidy.mopidy.count":1,"Processes.bash.pi.count":1,"Processes.linode-longview.root.ioreadkbytes":233472,"Processes.sshd.pi.ioreadkbytes":0,"Processes.wpa_supplicant.root.ioreadkbytes":0,"Processes.sshd.root.count":2,"Processes.raspi-config.root.ioreadkbytes":28672,"Disk./dev/mmcblk0p2.fs.free":5888700416,"Network.Interface.lo.tx_bytes":2548,"Disk./dev/mmcblk0p1.fs.total":58662912,"Processes.sshd.root.iowritekbytes":107724800,"Processes.udevd.root.ioreadkbytes":9867264,"Processes.dhclient.root.iowritekbytes":0,"Processes.thd.nobody.ioreadkbytes":0,"Disk./dev/mmcblk0p2.write_bytes":535302144,"Processes.cron.root.ioreadkbytes":32768,"Processes.thd.nobody.count":1,"Processes.getty.root.mem":4752,"Processes.thd.nobody.cpu":8,"Disk./dev/mmcblk0p2.fs.itotal":482880,"Disk./dev/mmcblk0p1.fs.ifree":0,"Processes.ifplugd.root.mem":1516,"Disk./dev/mmcblk0p1.fs.itotal":0,"Processes.bash.pi.iowritekbytes":150003712,"CPU.cpu0.wait":8629,"Processes.login.root.cpu":6,"Processes.cron.root.cpu":2,"Memory.real.cache":308268,"Processes.init.root.cpu":180,"Processes.wpa_supplicant.root.mem":1256,"CPU.cpu0.user":91384,"Processes.ifplugd.root.count":3,"Memory.real.used":422004,"Memory.real.free":26176,"Processes.init.root.ioreadkbytes":38086144,"Processes.mopidy.mopidy.ioreadkbytes":282624,"Processes.whiptail.root.count":1,"Disk./dev/mmcblk0p2.writes":10815,"Processes.sshd.pi.mem":1576,"Processes.sshd.pi.iowritekbytes":0,"Processes.login.root.count":1,"Processes.udevd.root.iowritekbytes":0,"Network.Interface.lo.rx_bytes":2548,"Processes.linode-longview.root.cpu":3537,"Processes.bash.root.ioreadkbytes":577536,"Processes.bash.pi.mem":3488,"Processes.cron.root.mem":784,"Network.Interface.wlan0.tx_bytes":13162346,"Disk./dev/mmcblk0p2.read_bytes":171602944,"Processes.rsyslogd.root.ioreadkbytes":618496,"Processes.whiptail.root.cpu":4,"Processes.ntpd.ntp.ioreadkbytes":32768,"Disk./dev/mmcblk0p1.read_bytes":115200,"Processes.udevd.root.count":3,"Memory.swap.free":102396,"Processes.dhclient.root.mem":1992,"Processes.dbus-daemon.messagebus.ioreadkbytes":0,"Processes.wpa_supplicant.root.cpu":30,"Processes.rsyslogd.root.mem":1548,"Processes.udevd.root.mem":3292,"Processes.mopidy.mopidy.mem":50008,"Processes.ntpd.ntp.mem":1980,"Processes.dbus-daemon.messagebus.count":1,"Processes.ntpd.ntp.count":1,"Processes.rsyslogd.root.cpu":14,"Processes.dhclient.root.ioreadkbytes":0,"Network.Interface.wlan0.rx_bytes":191314151,"Memory.real.buffers":22852,"Processes.raspi-config.root.mem":584,"Processes.raspi-config.root.cpu":1,"Processes.sshd.pi.cpu":165,"Processes.sshd.root.cpu":39,"Processes.ntpd.ntp.cpu":93,"Memory.swap.used":0,"Processes.login.root.ioreadkbytes":598016,"Processes.whiptail.root.mem":1468,"Processes.linode-longview.root.iowritekbytes":35905536,"CPU.cpu0.system":27242,"Processes.wpa_supplicant.root.iowritekbytes":0,"Processes.linode-longview.root.mem":12884,"Processes.bash.pi.ioreadkbytes":114520064,"Processes.ifplugd.root.ioreadkbytes":155648,"Processes.getty.root.count":6,"Processes.dbus-daemon.messagebus.cpu":1,"Processes.mopidy.mopidy.iowritekbytes":138760192,"Processes.bash.root.cpu":52,"Processes.cron.root.iowritekbytes":4096,"Processes.init.root.mem":712,"Disk./dev/mmcblk0p1.write_bytes":0,"Processes.getty.root.iowritekbytes":4096,"Processes.bash.root.iowritekbytes":0,"Processes.thd.nobody.iowritekbytes":0,"Processes.ifplugd.root.iowritekbytes":0,"Processes.cron.root.count":1,"Load":0.05},"timestamp":1395158964,"INSTANT":{"Processes.raspi-config.longname":"/bin/sh","Processes.udevd.longname":"udevd","Disk./dev/mmcblk0p2.childof":0,"Network.mac_addr":"b8:27:eb:39:4b:ce","Uptime":4330.97,"Processes.getty.longname":"/sbin/getty","SysInfo.os.dist":"Debian","Processes.thd.longname":"/usr/sbin/thd","Processes.dbus-daemon.longname":"/usr/bin/dbus-daemon","Disk./dev/mmcblk0p2.fs.path":"/","Processes.bash.longname":"-bash","Processes.init.longname":"init [2]","Processes.ifplugd.longname":"/usr/sbin/ifplugd","Processes.rsyslogd.longname":"/usr/sbin/rsyslogd","SysInfo.cpu.type":"ARMv6-compatible processor rev 7 (v6l)","Disk./dev/mmcblk0p1.isswap":0,"Processes.mopidy.longname":"/usr/bin/python","Disk./dev/mmcblk0p2.dm":0,"Disk./dev/mmcblk0p1.children":0,"Processes.ntpd.longname":"/usr/sbin/ntpd","Ports.active":[{"count":1,"user":"pi","name":"sshd"},{"count":1,"user":"root","name":"sshd"},{"count":6,"user":"mopidy","name":"mopidy"}],"Disk./dev/mmcblk0p2.mounted":1,"Disk./dev/mmcblk0p2.children":0,"Processes.cron.longname":"/usr/sbin/cron","SysInfo.cpu.cores":1,"SysInfo.hostname":"airpi","Processes.sshd.longname":"sshd: pi@pts/0","Disk./dev/mmcblk0p1.fs.path":"/boot","SysInfo.type":"baremetal","Processes.linode-longview.longname":"linode-longview","Ports.listening":[{"ip":"0.0.0.0","user":"ntp","name":"ntpd","type":"udp","port":123},{"ip":"192.168.1.4","user":"ntp","name":"ntpd","type":"udp","port":123},{"ip":"0.0.0.0","user":"root","name":"dhclient","type":"udp","port":68},{"ip":"0.0.0.0","user":"root","name":"sshd","type":"tcp","port":22},{"ip":"::","user":"mopidy","name":"mopidy","type":"tcp6","port":6600},{"ip":"::","user":"mopidy","name":"mopidy","type":"tcp6","port":6680},{"ip":"0.0.0.0","user":"root","name":"dhclient","type":"udp","port":11604},{"ip":"127.0.0.1","user":"ntp","name":"ntpd","type":"udp","port":123}],"Disk./dev/mmcblk0p1.dm":0,"Disk./dev/mmcblk0p2.isswap":0,"Disk./dev/mmcblk0p1.mounted":1,"SysInfo.client":"1.1.4","SysInfo.kernel":"Linux 3.10.25+","Processes.whiptail.longname":"whiptail","SysInfo.arch":"armv6l","Processes.dhclient.longname":"dhclient","Disk./dev/mmcblk0p1.childof":0,"Processes.wpa_supplicant.longname":"/sbin/wpa_supplicant","SysInfo.os.distversion":"7.2","Processes.login.longname":"/bin/login"}}],"apikey":"59C33037-9F11-04FF-DCAF77F35876DE71"}';
$json_array = json_decode($string);
echo '<pre>';
//var_dump($json_array);
echo $json_array->payload[0]->LONGTERM->Load;
echo '<br>';
echo $json_array->payload[0]->LONGTERM->CPU.cpu0.system;
echo '<br>';
echo $json_array->payload[0]->LONGTERM->CPU.cpu0.user;
echo '<br>';
echo $json_array->payload[0]->LONGTERM->CPU.cpu0.wait;
echo '<br>';
echo $json_array->payload[0]->INSTANT->SysInfo.os.dist;
echo '<br>';
//var_dump($json_array->payload[0]->INSTANT);
echo '<br>';
echo $json_array->payload[0]->INSTANT->SysInfo.cpu.type;
echo '<br>';
echo $json_array->payload[0]->INSTANT->SysInfo.hostname;
echo '<br>';
echo $json_array->payload[0]->INSTANT->SysInfo.kernel;

echo '<br>';
echo gmdate("H:i:s", $json_array->payload[0]->INSTANT->Uptime);
echo '</pre>';
echo '-------';
date_default_timezone_set("Europe/Berlin");
$insert = 'insert'.date('H:i:s',time());
$connection = new MongoClient( "mongodb://suchtundordnung.de");
if($connection) echo "connected to mongodb";
$db = $connection->rasp_status;
$collection = $db->longview;
$collection->insert($json_array);



